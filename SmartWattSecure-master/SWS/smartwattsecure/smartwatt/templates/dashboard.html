{%load static%}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Smart Watt Secure</title>
    <link rel="stylesheet" href="{% static 'css/db.css' %}" />
  </head>
  <body>
    <div class="dashboard-wrapper">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="logo">
          <h2>SWS</h2>
        </div>
        <nav class="sidebar-nav">
          <ul>
            <li>
              <a href="{% url 'dashboard' %}" id="dashboard-link">Dashboard</a>
            </li>
            <li>
              <a href="{% url 'analytics' %}" id="analytics-link">Analytics</a>
            </li>
            <li>
              <a href="{% url 'contact' %}" id="contact-link">Contact</a>
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Main Content -->
      <div class="main-content">
        <header class="main-header">
          {% if user.is_authenticated %}
            <h1>Welcome, {{ user.username }}!</h1>
            <div class="profile-menu">
              <button class="profile-btn">A</button>
            </div>
          {% else %}
            <p>You are not logged in.</p>
          {% endif %}
        </header>

        <main class="dashboard-main">
          <section class="dashboard-section">
            <h2>Latest Energy Data</h2>
            <div id="energy-data" class="dashboard-card">
              <!-- These will be updated dynamically by the fetchData function -->
              <p>Voltage: <span id="voltage">-</span> V</p>
              <p>Current: <span id="current">-</span> A</p>
              <p>Power: <span id="power">-</span> W</p>
              <p>Total Units Consumed: <span id="total-units">-</span> kWh</p>
              <p>Prediction: <span id="prediction">-</span></p>
            </div>
          </section>
        </main>
      </div>
    </div>

    <script>
      // Fetch the latest data using AJAX
      function fetchData() {
        fetch('/api/energy_data/')
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(data => {
                if (data.length > 0) {
                    const latestData = data[0];  // Get the latest entry
    
                    document.getElementById('voltage').innerText = `${latestData.voltage}`;
                    document.getElementById('current').innerText = `${latestData.current}`;
                    document.getElementById('power').innerText = `${latestData.power}`;
                    document.getElementById('total-units').innerText = `${latestData.total_units_consumed}`;
                    document.getElementById('prediction').innerText = `${latestData.prediction}`;
                } else {
                    console.log("No data available.");
                }
            })
            .catch(error => {
                console.error("There was a problem with the fetch operation:", error);
            });
    }
    
    setInterval(fetchData, 10000);
    </script>
  </body>
</html>



