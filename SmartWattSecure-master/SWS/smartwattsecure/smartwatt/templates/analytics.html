{%load static%}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics - Smart Watt Secure</title>
    <link rel="stylesheet" href="{% static 'css/ana.css'%}" />
    <link rel="stylesheet" href="{% static 'js/ana.js'%}" />
    <!-- Use the same CSS file as Dashboard -->
  </head>
  <body>
    <div class="dashboard-wrapper">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="logo">
          <h2>SWS</h2>
        </div>
        <nav class="sidebar-nav">
          <ul>
            <li>
              <a href="{% url 'dashboard' %}" id="dashboard-link">Dashboard</a>
            </li>
            <li>
              <a href="{% url 'analytics' %}" id="analytics-link" class="active"
                >Analytics</a
              >
            </li>
            <li><a href="{% url 'contact' %}" id="contact-link">Contact</a></li>
          </ul>
        </nav>
      </aside>

      <!-- Main Content -->
      <div class="main-content">
        <header class="main-header">
          <h1>Analytics</h1>
          <div class="profile-menu">
            <!-- Circular profile button with letter -->
            <button class="profile-btn">A</button>
            <!-- <div class="profile-dropdown">
                            <a href="#">Change Name</a>
                            <a href="#">Change Password</a>
                        </div> -->
          </div>
        </header>

        <div class="analytics-wrapper">
          <h2>Units Consumed</h2>

          <!-- Button Container -->
          <div class="button-container">
            <button id="daily-btn">Daily</button>
            <button id="weekly-btn">Weekly</button>
            <button id="monthly-btn">Monthly</button>
          </div>

          <div id="chartContainer">
            <canvas id="unitsConsumedChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetch("/api/units-consumed/")
          .then((response) => response.json())
          .then((data) => {
            const labels = data.map((item) => item.date); // Replace with actual field name
            const units = data.map((item) => item.units); // Replace with actual field name

            const ctx = document
              .getElementById("unitsConsumedChart")
              .getContext("2d");
            new Chart(ctx, {
              type: "line",
              data: {
                labels: labels,
                datasets: [
                  {
                    label: "Units Consumed",
                    data: units,
                    borderColor: "#c62828",
                    backgroundColor: "rgba(198, 40, 40, 0.1)",
                    fill: true,
                  },
                ],
              },
              options: {
                responsive: true,
                scales: {
                  x: {
                    title: { display: true, text: "Date" },
                  },
                  y: {
                    title: { display: true, text: "Units" },
                  },
                },
              },
            });
          })
          .catch((error) => console.error("Error fetching data:", error));
      });
    </script>
  </body>
</html>
